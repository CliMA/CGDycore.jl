<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Stiffness Matrix · CGDycore.jl</title><meta name="title" content="Stiffness Matrix · CGDycore.jl"/><meta property="og:title" content="Stiffness Matrix · CGDycore.jl"/><meta property="twitter:title" content="Stiffness Matrix · CGDycore.jl"/><meta name="description" content="Documentation for CGDycore.jl."/><meta property="og:description" content="Documentation for CGDycore.jl."/><meta property="twitter:description" content="Documentation for CGDycore.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">CGDycore.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../MassMatrix/">Mass Matrix</a></li><li class="is-active"><a class="tocitem" href>Stiffness Matrix</a><ul class="internal"><li><a class="tocitem" href="#StiffMatrix-in-FEMSei"><span>StiffMatrix in FEMSei</span></a></li><li><a class="tocitem" href="#General"><span>General</span></a></li><li><a class="tocitem" href="#Notes"><span>Notes</span></a></li></ul></li><li><a class="tocitem" href="../Examples/">Examples</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Stiffness Matrix</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Stiffness Matrix</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/CliMA/CGDycore.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/CliMA/CGDycore.jl/blob/main/docs/src/StiffMatrix.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Stiffness-Matrix"><a class="docs-heading-anchor" href="#Stiffness-Matrix">Stiffness Matrix</a><a id="Stiffness-Matrix-1"></a><a class="docs-heading-anchor-permalink" href="#Stiffness-Matrix" title="Permalink"></a></h1><p><em>The stiffness matrix</em> represents the discretized weak form of differential operators (e.g., curl-curl, grad-div, Laplacian) in finite element methods.</p><ul><li>It encodes the action of the differential operator on the chosen basis functions.</li><li>The stiffness matrix is typically sparse and symmetric (for self-adjoint operators).</li><li>Efficient assembly and application are crucial for large-scale simulations.</li></ul><h2 id="StiffMatrix-in-FEMSei"><a class="docs-heading-anchor" href="#StiffMatrix-in-FEMSei">StiffMatrix in FEMSei</a><a id="StiffMatrix-in-FEMSei-1"></a><a class="docs-heading-anchor-permalink" href="#StiffMatrix-in-FEMSei" title="Permalink"></a></h2><p>The <code>StiffMatrix</code> function assembles the global stiffness matrix for various finite element types (e.g., <code>HCurlElement</code>, <code>HDivElement</code>, <code>ScalarElement</code>, <code>VectorElement</code>).   It uses numerical quadrature and the mapping from reference to physical elements.</p><h2 id="General"><a class="docs-heading-anchor" href="#General">General</a><a id="General-1"></a><a class="docs-heading-anchor-permalink" href="#General" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="CGDycore.FEMSei.VortCrossVel!" href="#CGDycore.FEMSei.VortCrossVel!"><code>CGDycore.FEMSei.VortCrossVel!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>VortCrossVel!(backend, FTB, Rhs, u, uFe::HDivConfElement, q, qFe::ScalarElement, FeT::HDivConfElement, Grid, QuadOrd, Jacobi)</p><p>Assembles the right-hand side (Rhs) vector for the vorticity-cross-velocity term in a finite element method (FEM) context, specifically for mixed HDiv and scalar elements.</p><p><strong>Arguments</strong></p><ul><li><code>backend</code>: Computational backend or context (e.g., CPU/GPU).</li><li><code>FTB</code>: (Unused in this function) Placeholder for future extensions or backend-specific data.</li><li><code>Rhs</code>: The right-hand side vector to be assembled (modified in-place).</li><li><code>u</code>: Coefficient vector for the velocity field.</li><li><code>uFe::HDivConfElement</code>: HDiv-conforming finite element description for the velocity field.</li><li><code>q</code>: Coefficient vector for the scalar field (e.g., vorticity or pressure).</li><li><code>qFe::ScalarElement</code>: Scalar finite element description for the scalar field.</li><li><code>FeT::HDivConfElement</code>: HDiv-conforming finite element description for the test functions.</li><li><code>Grid</code>: Grid or mesh data structure containing geometry and connectivity.</li><li><code>QuadOrd</code>: Quadrature order for numerical integration.</li><li><code>Jacobi</code>: Function to compute the Jacobian, its determinant, and pseudo-inverse for mapping reference to physical elements.</li></ul><p><strong>Description</strong></p><p>For each face in the grid, this function:</p><ul><li>Evaluates basis functions and their values at quadrature points.</li><li>Computes the local contributions to the right-hand side vector by integrating the vorticity-cross-velocity term using the provided quadrature rule.</li><li>Applies the transformation from reference to physical element using the Jacobian.</li><li>Accumulates the local contributions into the global <code>Rhs</code> vector.</li></ul><p><strong>Notes</strong></p><ul><li>Assumes that the basis functions and their global-to-local mappings are provided in the finite element objects.</li><li>Uses in-place operations and preallocated arrays for efficiency.</li><li>The function is intended for use in mixed finite element formulations involving HDiv and scalar elements.</li></ul><p><strong>See also</strong></p><ul><li><code>HDivConfElement</code></li><li><code>ScalarElement</code></li><li><code>QuadRule</code></li><li><code>Jacobi</code></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CGDycore.jl/blob/4f656e525865827c474f4038670be2c7560266f9/src/FEM/StiffMatrix.jl#L1-L36">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="CGDycore.FEMSei.DivMatrix" href="#CGDycore.FEMSei.DivMatrix"><code>CGDycore.FEMSei.DivMatrix</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>DivMatrix(backend, FTB, FeF::HDivConfElement, FeT::ScalarElement, Grid, QuadOrd, Jacobi)</p><p>Assembles the divergence matrix for a finite element method (FEM) problem, coupling an <code>HDivConfElement</code> (face element) and a <code>ScalarElement</code> (cell element) over a given grid.</p><p><strong>Arguments</strong></p><ul><li><code>backend</code>: Computational backend to use (e.g., CPU, GPU).</li><li><code>FTB</code>: Additional backend or finite element type information.</li><li><code>FeF::HDivConfElement</code>: The face finite element with divergence basis functions.</li><li><code>FeT::ScalarElement</code>: The scalar finite element with basis functions.</li><li><code>Grid</code>: The grid structure containing mesh and face information.</li><li><code>QuadOrd</code>: Quadrature order for numerical integration.</li><li><code>Jacobi</code>: Function to compute the Jacobian, its determinant, and pseudo-inverse for mapping reference to physical elements.</li></ul><p><strong>Returns</strong></p><ul><li><code>Div</code>: A sparse matrix representing the divergence operator assembled over the grid.</li></ul><p><strong>Details</strong></p><ul><li>Uses quadrature to integrate the product of test and trial functions (and their divergences) over each face in the grid.</li><li>Handles mapping from reference to physical elements using the provided <code>Jacobi</code> function.</li><li>Assembles the global sparse matrix using local contributions from each face.</li></ul><p><strong>Notes</strong></p><ul><li>Assumes that <code>FeT.phi</code> and <code>FeF.Divphi</code> are arrays of functions for evaluating basis functions and their divergences at quadrature points.</li><li>The orientation of each face is taken into account via <code>Grid.Faces[iF].Orientation</code>.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CGDycore.jl/blob/4f656e525865827c474f4038670be2c7560266f9/src/FEM/StiffMatrix.jl#L81-L106">source</a></section><section><div><p>DivMatrix(backend, FTB, FeF::HDivKiteDElement, FeT::ScalarElement, Grid, QuadOrd, Jacobi)</p><p>Assembles the divergence matrix for a finite element method (FEM) discretization using HDiv-conforming kite elements (<code>FeF</code>) and scalar elements (<code>FeT</code>) on a given grid.</p><p><strong>Arguments</strong></p><ul><li><code>backend</code>: Computational backend to use (e.g., for parallelization or hardware selection).</li><li><code>FTB</code>: Additional backend or finite element type information (usage context-dependent).</li><li><code>FeF::HDivKiteDElement</code>: The HDiv-conforming finite element for the faces (vector-valued).</li><li><code>FeT::ScalarElement</code>: The scalar finite element for the target space (scalar-valued).</li><li><code>Grid</code>: The computational grid containing geometry and topology information.</li><li><code>QuadOrd</code>: The order of the quadrature rule to use for numerical integration.</li><li><code>Jacobi</code>: Function to compute the Jacobian, its determinant, and pseudo-inverse for mapping reference to physical elements.</li></ul><p><strong>Returns</strong></p><ul><li><code>Div</code>: A sparse matrix representing the divergence operator assembled over all faces of the grid.</li></ul><p><strong>Details</strong></p><ul><li>Computes basis function values and their divergences at quadrature points on both the reference element and its edges.</li><li>Integrates the contributions using quadrature rules for both the element interior and its boundaries.</li><li>Assembles the local divergence matrices into a global sparse matrix using global degree-of-freedom (DoF) mappings.</li><li>Handles orientation and geometry transformations via the provided <code>Jacobi</code> function.</li></ul><p><strong>Notes</strong></p><ul><li>The function assumes that the basis functions and their divergences are provided as callable objects in <code>FeT.phi</code>, <code>FeF.phi</code>, and <code>FeF.Divphi</code>.</li><li>The grid and element structures must provide necessary geometric and topological information, including face orientations and global DoF mappings.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CGDycore.jl/blob/4f656e525865827c474f4038670be2c7560266f9/src/FEM/StiffMatrix.jl#L448-L474">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="CGDycore.FEMSei.LaplMatrix" href="#CGDycore.FEMSei.LaplMatrix"><code>CGDycore.FEMSei.LaplMatrix</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>LaplMatrix(backend, FTB, FeF::ScalarElement, FeT::ScalarElement, Grid, QuadOrd, Jacobi)</p><p>Assembles the global Laplacian (stiffness) matrix for a finite element method (FEM) discretization.</p><p><strong>Arguments</strong></p><ul><li><code>backend</code>: Computational backend to use (not used directly in this function).</li><li><code>FTB</code>: Additional backend or transformation information (not used directly in this function).</li><li><code>FeF::ScalarElement</code>: Finite element object for the test space (provides basis function gradients and global DoF mapping).</li><li><code>FeT::ScalarElement</code>: Finite element object for the trial space (provides basis function gradients and global DoF mapping).</li><li><code>Grid</code>: Grid or mesh object containing information about the domain, faces, and geometry.</li><li><code>QuadOrd</code>: Quadrature order to use for numerical integration.</li><li><code>Jacobi</code>: Function that computes the Jacobian matrix, its determinant, and its pseudo-inverse for a given face and reference point.</li></ul><p><strong>Returns</strong></p><ul><li><code>Lapl</code>: Sparse matrix representing the assembled global Laplacian (stiffness) matrix.</li></ul><p><strong>Description</strong></p><p>This function computes the global Laplacian matrix by looping over all faces of the mesh, performing numerical integration using the specified quadrature rule, and assembling local element matrices into the global sparse matrix. The gradients of the basis functions are mapped from the reference element to the physical element using the Jacobian and its pseudo-inverse.</p><p><strong>Notes</strong></p><ul><li>The function assumes 2D elements and uses two components for gradients.</li><li>The local-to-global mapping for degrees of freedom is provided by <code>FeT.Glob</code> and <code>FeF.Glob</code>.</li><li>The function is optimized for performance using <code>@inbounds</code> and preallocated arrays.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CGDycore.jl/blob/4f656e525865827c474f4038670be2c7560266f9/src/FEM/StiffMatrix.jl#L152-L176">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="CGDycore.FEMSei.DivRhs!" href="#CGDycore.FEMSei.DivRhs!"><code>CGDycore.FEMSei.DivRhs!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>DivRhs!(backend, FTB, Div, FeT::ScalarElement, u, uFeF::HDivConfElement,       Grid, ElemType::Grids.ElementType, QuadOrd, Jacobi)</p><p>Assembles the right-hand side vector for the divergence operator in a finite element method (FEM) context, specifically for scalar test functions and H(div)-conforming trial functions.</p><p><strong>Arguments</strong></p><ul><li><code>backend</code>: Computational backend to use (e.g., CPU, GPU).</li><li><code>FTB</code>: Finite element basis or related data structure.</li><li><code>Div</code>: Output vector to accumulate the divergence right-hand side contributions (modified in-place).</li><li><code>FeT::ScalarElement</code>: Scalar finite element type for the test space.</li><li><code>u</code>: Global vector of degrees of freedom for the H(div)-conforming field.</li><li><code>uFeF::HDivConfElement</code>: H(div)-conforming finite element type for the trial space.</li><li><code>Grid</code>: Grid or mesh data structure containing face and orientation information.</li><li><code>ElemType::Grids.ElementType</code>: Element type descriptor for quadrature rule selection.</li><li><code>QuadOrd</code>: Quadrature order for numerical integration.</li><li><code>Jacobi</code>: Jacobian or transformation data (not used directly in this function).</li></ul><p><strong>Description</strong></p><p>For each face in the grid, this function:</p><ol><li>Evaluates basis functions and their divergences at quadrature points.</li><li>Computes local contributions to the divergence right-hand side by integrating the product of test and trial functions over each face, taking into account face orientation and quadrature weights.</li><li>Assembles these local contributions into the global <code>Div</code> vector.</li></ol><p><strong>Notes</strong></p><ul><li>The function assumes 2D reference elements and that basis function evaluations are provided as callable objects.</li><li>The function is intended for use in mixed finite element methods, such as those involving H(div) spaces (e.g., Raviart-Thomas elements).</li><li>All operations are performed in-place for efficiency.</li></ul><p><strong>In-place Behavior</strong></p><ul><li>The <code>Div</code> vector is updated in-place with the assembled right-hand side contributions.</li></ul><p><strong>Performance</strong></p><ul><li>Uses <code>@inbounds</code> for performance; ensure input data is valid to avoid out-of-bounds errors.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CGDycore.jl/blob/4f656e525865827c474f4038670be2c7560266f9/src/FEM/StiffMatrix.jl#L223-L258">source</a></section><section><div><p>DivRhs!(backend, FTB, Div, u, uFeF::HDivKiteDElement, FeT::ScalarElement, Grid, ElemType::Grids.ElementType,       QuadOrd, Jacobi)</p><p>Assembles the right-hand side vector for the divergence operator in a finite element method (FEM) context, specifically for mixed formulations involving H(div) elements on quadrilateral (kite) meshes.</p><p><strong>Arguments</strong></p><ul><li><code>backend</code>: Computational backend to use (e.g., CPU, GPU).</li><li><code>FTB</code>: (Purpose not specified in the code snippet; likely a finite element transformation or buffer).</li><li><code>Div</code>: Output vector to accumulate the divergence contributions (modified in-place).</li><li><code>u</code>: Input vector of degrees of freedom for the H(div) field.</li><li><code>uFeF::HDivKiteDElement</code>: H(div) finite element definition for the face elements.</li><li><code>FeT::ScalarElement</code>: Scalar finite element definition for the test space.</li><li><code>Grid</code>: Grid structure containing mesh and face information.</li><li><code>ElemType::Grids.ElementType</code>: Element type descriptor for quadrature rule selection.</li><li><code>QuadOrd</code>: Quadrature order for numerical integration.</li><li><code>Jacobi</code>: (Purpose not specified in the code snippet; possibly a flag or structure for Jacobian transformations).</li></ul><p><strong>Description</strong></p><ul><li>Precomputes basis function values and their divergences at quadrature points for both the element interior and its edges.</li><li>Loops over all faces in the grid, assembling local contributions to the divergence right-hand side vector.</li><li>Integrates both over the element interior and its boundaries using appropriate quadrature rules.</li><li>Handles orientation of faces and global-to-local degree of freedom mappings.</li><li>Accumulates the computed local divergence contributions into the global <code>Div</code> vector.</li></ul><p><strong>Notes</strong></p><ul><li>The function is intended for use in mixed FEM formulations, such as those arising in incompressible flow or electromagnetics.</li><li>Assumes that the finite element types and grid structures provide the necessary basis function evaluation and mapping utilities.</li><li>Uses in-place modification for performance.</li></ul><p><strong>See also</strong></p><ul><li>[<code>QuadRule</code>]: For quadrature rule generation.</li><li>[<code>HDivKiteDElement</code>], [<code>ScalarElement</code>]: For finite element definitions.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CGDycore.jl/blob/4f656e525865827c474f4038670be2c7560266f9/src/FEM/StiffMatrix.jl#L542-L575">source</a></section><section><div><p>DivRhs!(backend, FTB, Div, u, uFeF::HDivKiteDElement, h, hFeF::ScalarElement, FeT::ScalarElement, Grid,       ElemType::Grids.ElementType, QuadOrd, Jacobi)</p><p>Assembles the right-hand side (RHS) vector for the divergence operator in a finite element method (FEM) context, specifically for mixed finite element spaces involving H(div) and scalar elements on a kite-shaped reference element.</p><p><strong>Arguments</strong></p><ul><li><code>backend</code>: Computational backend to use (e.g., CPU, GPU).</li><li><code>FTB</code>: (Purpose not specified; likely a finite element basis or transformation object.)</li><li><code>Div</code>: Output vector to accumulate the divergence RHS contributions (modified in-place).</li><li><code>u</code>: Vector of degrees of freedom (DoFs) for the H(div) field.</li><li><code>uFeF::HDivKiteDElement</code>: H(div) finite element object for the vector field.</li><li><code>h</code>: Vector of DoFs for the scalar field.</li><li><code>hFeF::ScalarElement</code>: Scalar finite element object for the scalar field.</li><li><code>FeT::ScalarElement</code>: Scalar finite element object for the test space.</li><li><code>Grid</code>: Grid or mesh structure containing element and face information.</li><li><code>ElemType::Grids.ElementType</code>: Type of the element (e.g., reference kite).</li><li><code>QuadOrd</code>: Quadrature order for numerical integration.</li><li><code>Jacobi</code>: (Purpose not specified; possibly a flag or structure for Jacobi preconditioning or integration.)</li></ul><p><strong>Description</strong></p><ul><li>Computes local contributions to the divergence RHS by evaluating basis functions and their divergences at quadrature points.</li><li>Integrates over both the element interior and its faces/edges using appropriate quadrature rules.</li><li>Accumulates the results into the global RHS vector <code>Div</code> using the global DoF mapping.</li></ul><p><strong>Notes</strong></p><ul><li>The function is intended for use in mixed FEM formulations, such as those arising in fluid dynamics or electromagnetics.</li><li>Assumes that the basis functions and their divergences are provided as callable objects in the finite element structures.</li><li>Uses in-place modification for performance.</li></ul><p><strong>In-place</strong></p><ul><li>Modifies the <code>Div</code> vector in-place.</li></ul><p><strong>Performance</strong></p><ul><li>Uses <code>@inbounds</code> and preallocated arrays for efficiency.</li><li>Suitable for use in performance-critical assembly loops.</li></ul><p><strong>See also</strong></p><ul><li><code>QuadRule</code></li><li><code>HDivKiteDElement</code></li><li><code>ScalarElement</code></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CGDycore.jl/blob/4f656e525865827c474f4038670be2c7560266f9/src/FEM/StiffMatrix.jl#L1378-L1419">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="CGDycore.FEMSei.GradRhs!" href="#CGDycore.FEMSei.GradRhs!"><code>CGDycore.FEMSei.GradRhs!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>GradRhs!(backend, FTB, Grad, h, hFeF::ScalarElement, FeT::HDivConfElement, Grid, ElemType::Grids.ElementType,        QuadOrd, Jacobi)</p><p>Assembles the right-hand side (RHS) contribution for the gradient operator in a finite element method (FEM) context, specifically for mixed formulations involving scalar and HDiv-conforming elements.</p><p><strong>Arguments</strong></p><ul><li><code>backend</code>: Computational backend to use (e.g., CPU, GPU).</li><li><code>FTB</code>: (Purpose not specified in the code snippet; likely a data structure for finite element assembly).</li><li><code>Grad</code>: Array to accumulate the assembled gradient RHS contributions (modified in-place).</li><li><code>h</code>: Array of scalar field degrees of freedom (DoFs).</li><li><code>hFeF::ScalarElement</code>: Scalar finite element descriptor for the field <code>h</code>.</li><li><code>FeT::HDivConfElement</code>: HDiv-conforming finite element descriptor for the test space.</li><li><code>Grid</code>: Grid or mesh data structure containing face and orientation information.</li><li><code>ElemType::Grids.ElementType</code>: Element type descriptor (e.g., triangle, quadrilateral).</li><li><code>QuadOrd</code>: Quadrature order for numerical integration.</li><li><code>Jacobi</code>: (Purpose not specified in the code snippet; possibly a flag or structure for Jacobian handling).</li></ul><p><strong>Description</strong></p><p>For each face in the grid, this function:</p><ul><li>Evaluates basis functions and their divergences at quadrature points.</li><li>Computes local contributions to the gradient RHS using quadrature.</li><li>Assembles these local contributions into the global <code>Grad</code> array.</li></ul><p>The function is optimized with <code>@inbounds</code> for performance and assumes that the basis function arrays and grid structures are properly initialized.</p><p><strong>Notes</strong></p><ul><li>The function modifies <code>Grad</code> in-place.</li><li>The function assumes that the basis function arrays (<code>phi</code>, <code>Divphi</code>) are callable with reference coordinates.</li><li>The purpose of <code>backend</code>, <code>FTB</code>, and <code>Jacobi</code> is not fully specified in the provided code.</li></ul><p><strong>See Also</strong></p><ul><li><code>ScalarElement</code></li><li><code>HDivConfElement</code></li><li><code>QuadRule</code></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CGDycore.jl/blob/4f656e525865827c474f4038670be2c7560266f9/src/FEM/StiffMatrix.jl#L304-L339">source</a></section><section><div><p>GradRhs!(backend, FTB, Grad, h, hFeF::ScalarElement, u, uFeF::HDivKiteDElement, FeT::HDivKiteDElement, Grid,        ElemType::Grids.ElementType, QuadOrd, Jacobi)</p><p>Assembles the gradient right-hand side (RHS) vector for a finite element method (FEM) problem involving scalar and vector fields on a grid with kite-shaped elements.</p><p><strong>Arguments</strong></p><ul><li><code>backend</code>: Computational backend to use (e.g., CPU, GPU).</li><li><code>FTB</code>: (Purpose not specified in code snippet; likely a context or buffer object).</li><li><code>Grad</code>: Array to accumulate the assembled gradient RHS.</li><li><code>h</code>: Array of scalar field values (e.g., height or pressure) at global degrees of freedom.</li><li><code>hFeF::ScalarElement</code>: Scalar finite element function space for <code>h</code>.</li><li><code>u</code>: Array of vector field values (e.g., velocity) at global degrees of freedom.</li><li><code>uFeF::HDivKiteDElement</code>: H(div) finite element function space for <code>u</code> on kite-shaped elements.</li><li><code>FeT::HDivKiteDElement</code>: H(div) finite element function space for test functions on kite-shaped elements.</li><li><code>Grid</code>: Grid structure containing mesh and face information.</li><li><code>ElemType::Grids.ElementType</code>: Type of element used in the grid.</li><li><code>QuadOrd</code>: Quadrature order for numerical integration.</li><li><code>Jacobi</code>: Function to compute the Jacobian, its determinant, and pseudo-inverse for coordinate transformations.</li></ul><p><strong>Description</strong></p><p>This function computes the local contributions to the gradient RHS vector for each face in the grid, using quadrature rules for both the element interior and its boundaries. It evaluates basis functions and their divergences at quadrature points, transforms field values to the physical domain, and assembles the contributions into the global RHS vector.</p><p>The function supports mixed finite element spaces (scalar and H(div) vector fields) and handles the mapping between reference and physical elements. It is designed for use in discontinuous Galerkin or mixed FEM formulations, particularly for problems involving conservation laws or fluid dynamics.</p><p><strong>Notes</strong></p><ul><li>The function modifies <code>Grad</code> in-place.</li><li>Assumes that the finite element spaces and grid structures are properly initialized and compatible.</li><li>The function is performance-oriented, using <code>@inbounds</code> and preallocated arrays to minimize allocations and bounds checking.</li></ul><p><strong>See Also</strong></p><ul><li><code>QuadRule</code></li><li><code>ScalarElement</code></li><li><code>HDivKiteDElement</code></li><li><code>Grids.ElementType</code></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CGDycore.jl/blob/4f656e525865827c474f4038670be2c7560266f9/src/FEM/StiffMatrix.jl#L1522-L1557">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="CGDycore.FEMSei.CurlMatrix" href="#CGDycore.FEMSei.CurlMatrix"><code>CGDycore.FEMSei.CurlMatrix</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>CurlMatrix(backend, FTB, FeF::HCurlConfElement, FeT::ScalarElement, Grid, QuadOrd, Jacobi)</p><p>Assembles the curl matrix for a finite element method (FEM) problem involving an <code>HCurlConfElement</code> (typically a vector-valued element with curl-conforming basis functions) and a <code>ScalarElement</code> (typically a scalar-valued element). The resulting sparse matrix represents the action of the curl operator in the FEM discretization.</p><p><strong>Arguments</strong></p><ul><li><code>backend</code>: Computational backend to use (e.g., CPU, GPU, etc.).</li><li><code>FTB</code>: Additional backend or finite element type information (usage depends on context).</li><li><code>FeF::HCurlConfElement</code>: The finite element object representing the curl-conforming (vector-valued) basis functions.</li><li><code>FeT::ScalarElement</code>: The finite element object representing the scalar-valued basis functions.</li><li><code>Grid</code>: The grid or mesh structure containing information about faces, orientations, and global DoF mappings.</li><li><code>QuadOrd</code>: The order of the quadrature rule to use for numerical integration.</li><li><code>Jacobi</code>: Jacobi data or transformation (usage depends on context).</li></ul><p><strong>Returns</strong></p><ul><li><code>Curl</code>: A sparse matrix representing the assembled curl operator between the given finite element spaces.</li></ul><p><strong>Details</strong></p><ul><li>Uses numerical quadrature to integrate the product of test and trial functions (and their curls) over each face of the grid.</li><li>Handles orientation of faces and global degree-of-freedom (DoF) mapping.</li><li>Efficiently assembles the matrix in sparse format.</li></ul><p><strong>Notes</strong></p><ul><li>Assumes that <code>FeT.phi</code> and <code>FeF.Curlphi</code> are arrays of function handles for evaluating basis functions and their curls at quadrature points.</li><li>The function is performance-optimized using <code>@inbounds</code> and preallocated arrays.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CGDycore.jl/blob/4f656e525865827c474f4038670be2c7560266f9/src/FEM/StiffMatrix.jl#L383-L408">source</a></section><section><div><p>CurlMatrix(backend, FTB, FeF::HCurlKiteDElement, FeT::ScalarElement, Grid, QuadOrd, Jacobi)</p><p>Assembles the curl matrix for a finite element method (FEM) discretization involving an <code>HCurlKiteDElement</code> (vector-valued, H(curl)-conforming element) and a <code>ScalarElement</code> (scalar-valued element) over a given grid.</p><p><strong>Arguments</strong></p><ul><li><code>backend</code>: Computational backend to use (e.g., CPU, GPU).</li><li><code>FTB</code>: Finite element type or basis information (purpose depends on context).</li><li><code>FeF::HCurlKiteDElement</code>: The H(curl)-conforming finite element object for the face (vector-valued).</li><li><code>FeT::ScalarElement</code>: The scalar-valued finite element object for the test function.</li><li><code>Grid</code>: The computational grid or mesh structure.</li><li><code>QuadOrd</code>: Quadrature order for numerical integration.</li><li><code>Jacobi</code>: Jacobian or transformation information for mapping reference to physical elements.</li></ul><p><strong>Returns</strong></p><ul><li><code>Curl</code>: A sparse matrix representing the assembled curl operator coupling the given finite element spaces.</li></ul><p><strong>Details</strong></p><ul><li>Computes basis and curl-basis functions at quadrature points on both the reference element and its edges.</li><li>Integrates the contributions using quadrature rules for both the element interior and its boundaries.</li><li>Assembles the local contributions into a global sparse matrix using the global degree-of-freedom (DoF) mappings.</li><li>The resulting matrix can be used in FEM formulations involving curl operators, such as in electromagnetics or fluid dynamics.</li></ul><p><strong>Notes</strong></p><ul><li>Assumes that <code>FeF</code> and <code>FeT</code> provide callable basis and curl-basis functions, as well as global DoF mappings.</li><li>The function is performance-optimized using <code>@inbounds</code> and preallocated arrays.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CGDycore.jl/blob/4f656e525865827c474f4038670be2c7560266f9/src/FEM/StiffMatrix.jl#L649-L675">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="CGDycore.FEMSei.GradMatrix" href="#CGDycore.FEMSei.GradMatrix"><code>CGDycore.FEMSei.GradMatrix</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>GradMatrix(backend, FTB, FeF::ScalarElement, FeT::HDivConfElement, Grid, QuadOrd, Jacobi)</p><p>Assembles the gradient matrix for a finite element method (FEM) problem involving a scalar element (<code>FeF</code>) and an H(div)-conforming element (<code>FeT</code>) on a given grid.</p><p><strong>Arguments</strong></p><ul><li><code>backend</code>: Computational backend to use (e.g., CPU, GPU).</li><li><code>FTB</code>: Finite element type or basis (usage context-dependent).</li><li><code>FeF::ScalarElement</code>: Scalar finite element object, providing basis functions and gradients.</li><li><code>FeT::HDivConfElement</code>: H(div)-conforming finite element object, providing vector-valued basis functions.</li><li><code>Grid</code>: Grid or mesh structure containing geometric and topological information.</li><li><code>QuadOrd</code>: Quadrature order for numerical integration.</li><li><code>Jacobi</code>: Function to compute the Jacobian, its determinant, and pseudo-inverse for mapping reference to physical elements.</li></ul><p><strong>Returns</strong></p><ul><li><code>Grad</code>: Sparse matrix representing the assembled gradient operator between the given finite element spaces.</li></ul><p><strong>Description</strong></p><p>The function computes the local contributions to the gradient matrix for each face in the grid using numerical quadrature. It evaluates the basis functions and their gradients at quadrature points, applies the appropriate geometric transformations, and assembles the global sparse matrix.</p><p><strong>Notes</strong></p><ul><li>The function assumes that <code>FeF</code> and <code>FeT</code> provide callable basis and gradient functions.</li><li>The grid structure must provide face orientation and global degree-of-freedom (DoF) mappings.</li><li>The assembly is performed in a memory-efficient way using sparse matrix construction.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CGDycore.jl/blob/4f656e525865827c474f4038670be2c7560266f9/src/FEM/StiffMatrix.jl#L737-L762">source</a></section><section><div><p>GradMatrix(backend, FTB, FeF::ScalarElement, FeT::HDivKiteDElement, Grid, QuadOrd, Jacobi)</p><p>Assembles the gradient matrix for a finite element method (FEM) discretization involving a scalar element (<code>FeF</code>) and an H(div) kite element (<code>FeT</code>) on a given grid.</p><p><strong>Arguments</strong></p><ul><li><code>backend</code>: Computational backend to use for matrix assembly.</li><li><code>FTB</code>: Additional backend or transformation information (purpose depends on context).</li><li><code>FeF::ScalarElement</code>: Scalar finite element providing basis functions and gradients.</li><li><code>FeT::HDivKiteDElement</code>: H(div) finite element providing vector-valued basis functions.</li><li><code>Grid</code>: Grid structure containing mesh and face information.</li><li><code>QuadOrd</code>: Quadrature order for numerical integration.</li><li><code>Jacobi</code>: Function to compute the Jacobian, its determinant, and pseudo-inverse for mapping reference to physical elements.</li></ul><p><strong>Returns</strong></p><ul><li><code>Grad</code>: Sparse matrix representing the assembled gradient operator.</li></ul><p><strong>Description</strong></p><p>The function computes the local contributions to the gradient matrix by evaluating basis functions and their gradients at quadrature points in the reference element and on its edges. It then maps these contributions to the global matrix using the grid&#39;s connectivity and orientation information. The resulting sparse matrix can be used in FEM solvers for problems involving mixed formulations or H(div) spaces.</p><p><strong>Notes</strong></p><ul><li>The function assumes that <code>FeF</code> and <code>FeT</code> provide callable basis and gradient functions indexed by degree of freedom and component.</li><li>The assembly uses in-place operations and preallocated arrays for efficiency.</li><li>The function is specialized for 2D elements with two components and their corresponding edge integrals.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CGDycore.jl/blob/4f656e525865827c474f4038670be2c7560266f9/src/FEM/StiffMatrix.jl#L808-L832">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="CGDycore.FEMSei.GradHeightSquared!" href="#CGDycore.FEMSei.GradHeightSquared!"><code>CGDycore.FEMSei.GradHeightSquared!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>GradHeightSquared!(backend, FTB, Rhs, FeT::HDivConfElement, h, hFeF::ScalarElement,             Grid, ElemType::Grids.ElementType, QuadOrd, Jacobi)</p><p>Assembles the contribution of the gradient of the squared height field to the right-hand side vector <code>Rhs</code> for a finite element method (FEM) discretization, typically used in shallow water or similar PDEs.</p><p><strong>Arguments</strong></p><ul><li><code>backend</code>: Computational backend or context (not used directly in this function).</li><li><code>FTB</code>: Additional backend or context parameter (not used directly in this function).</li><li><code>Rhs</code>: The right-hand side vector to be updated in-place.</li><li><code>FeT::HDivConfElement</code>: The finite element configuration for the vector-valued (H(div)) space.</li><li><code>h</code>: The global vector of height field values.</li><li><code>hFeF::ScalarElement</code>: The finite element configuration for the scalar (height) field.</li><li><code>Grid</code>: The grid or mesh structure containing face and connectivity information.</li><li><code>ElemType::Grids.ElementType</code>: The element type used for quadrature rule selection.</li><li><code>QuadOrd</code>: The order of the quadrature rule.</li><li><code>Jacobi</code>: The Jacobian or transformation information (not used directly in this function).</li></ul><p><strong>Description</strong></p><p>For each face in the grid, the function:</p><ol><li>Interpolates the height field <code>h</code> at quadrature points using the scalar basis functions.</li><li>Computes the divergence of the vector basis functions at quadrature points.</li><li>Assembles the local contributions of the gradient of the squared height (<code>∇(h^2)</code>) to the global right-hand side vector <code>Rhs</code>, scaled by gravity.</li></ol><p><strong>Notes</strong></p><ul><li>The function assumes that the basis functions and their divergences are provided as callable objects.</li><li>The gravity constant <code>Grav</code> is hardcoded as <code>9.80616</code>.</li><li>The function operates in-place and is performance-optimized with <code>@inbounds</code> and preallocated arrays.</li></ul><p><strong>Modifies</strong></p><ul><li><code>Rhs</code>: The right-hand side vector is updated in-place with the assembled contributions.</li></ul><p><strong>See also</strong></p><ul><li><code>QuadRule</code></li><li><code>HDivConfElement</code></li><li><code>ScalarElement</code></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CGDycore.jl/blob/4f656e525865827c474f4038670be2c7560266f9/src/FEM/StiffMatrix.jl#L899-L936">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="CGDycore.FEMSei.GradKinHeight!" href="#CGDycore.FEMSei.GradKinHeight!"><code>CGDycore.FEMSei.GradKinHeight!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>GradKinHeight!(backend, FTB, Rhs, h, hFeF::ScalarElement, u, uFeF::HDivConfElement,            FeT::HDivConfElement, Grid, ElemType::Grids.ElementType, QuadOrd, Jacobi)</p><p>Assembles the gradient of the kinetic height term for a finite element method (FEM) discretization, and adds the local contributions to the global right-hand side vector <code>Rhs</code>.</p><p><strong>Arguments</strong></p><ul><li><code>backend</code>: Computational backend (not used directly in this function).</li><li><code>FTB</code>: (Purpose not specified in the code snippet).</li><li><code>Rhs</code>: Global right-hand side vector to be updated in-place.</li><li><code>h</code>: Vector of height values at global degrees of freedom.</li><li><code>hFeF::ScalarElement</code>: Scalar finite element descriptor for the height field.</li><li><code>u</code>: Vector of velocity values at global degrees of freedom.</li><li><code>uFeF::HDivConfElement</code>: H(div)-conforming finite element descriptor for the velocity field.</li><li><code>FeT::HDivConfElement</code>: H(div)-conforming finite element descriptor for the test functions.</li><li><code>Grid</code>: Grid structure containing mesh and face information.</li><li><code>ElemType::Grids.ElementType</code>: Element type for quadrature rule selection.</li><li><code>QuadOrd</code>: Quadrature order for numerical integration.</li><li><code>Jacobi</code>: Function to compute the Jacobian, its determinant, and pseudo-inverse for mapping reference to physical elements.</li></ul><p><strong>Description</strong></p><p>For each face in the grid, this function:</p><ol><li>Evaluates basis functions and their divergences at quadrature points.</li><li>Maps local degrees of freedom to global indices and gathers local solution values.</li><li>Computes the local kinetic energy and potential energy contributions at quadrature points.</li><li>Integrates these contributions using the quadrature rule and assembles them into the global right-hand side vector <code>Rhs</code>.</li></ol><p>The gravitational constant is hardcoded as <code>Grav = 9.80616</code>.</p><p><strong>Notes</strong></p><ul><li>The function operates in-place on <code>Rhs</code>.</li><li>Assumes that the finite element descriptors (<code>hFeF</code>, <code>uFeF</code>, <code>FeT</code>) and the grid structure are properly initialized and compatible.</li><li>The function is performance-oriented, using <code>@inbounds</code> to skip bounds checking in loops.</li></ul><p><strong>Returns</strong></p><p>Nothing. The function updates <code>Rhs</code> in-place.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CGDycore.jl/blob/4f656e525865827c474f4038670be2c7560266f9/src/FEM/StiffMatrix.jl#L983-L1020">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="CGDycore.FEMSei.GradKinHeightInter!" href="#CGDycore.FEMSei.GradKinHeightInter!"><code>CGDycore.FEMSei.GradKinHeightInter!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>GradKinHeightInter!(backend, FTB, Rhs, h, hFeF::ScalarElement, u, uFeF::HDivConfElement,              FeT::HDivConfElement, Grid, ElemType::Grids.ElementType, QuadOrd, Jacobi)</p><p>Assembles the gradient of the kinetic height interaction term for a finite element method (FEM) discretization, and adds its contribution to the right-hand side vector <code>Rhs</code>.</p><p><strong>Arguments</strong></p><ul><li><code>backend</code>: Computational backend to use (e.g., CPU, GPU).</li><li><code>FTB</code>: (Purpose not specified in the code snippet; likely a data structure related to the finite element assembly).</li><li><code>Rhs</code>: Right-hand side vector to be updated in-place.</li><li><code>h</code>: Vector of height (scalar field) degrees of freedom.</li><li><code>hFeF::ScalarElement</code>: Scalar finite element descriptor for the height field.</li><li><code>u</code>: Vector of velocity (vector field) degrees of freedom.</li><li><code>uFeF::HDivConfElement</code>: H(div)-conforming finite element descriptor for the velocity field.</li><li><code>FeT::HDivConfElement</code>: H(div)-conforming finite element descriptor for the test functions.</li><li><code>Grid</code>: Grid or mesh data structure containing face and element information.</li><li><code>ElemType::Grids.ElementType</code>: Type of the finite element (e.g., triangle, quadrilateral).</li><li><code>QuadOrd</code>: Quadrature order for numerical integration.</li><li><code>Jacobi</code>: Function to compute the Jacobian, its determinant, and pseudo-inverse for the mapping from reference to physical element.</li></ul><p><strong>Description</strong></p><p>This function computes the local contributions of the gradient of the kinetic height interaction term for each face in the grid, using numerical quadrature. It evaluates basis functions and their divergences at quadrature points, transforms velocity components, and assembles the contributions into the global right-hand side vector <code>Rhs</code>. The gravitational constant is hardcoded as <code>Grav = 9.80616</code>.</p><p><strong>Notes</strong></p><ul><li>The function operates in-place and assumes all input arrays are properly sized and initialized.</li><li>The function is performance-optimized using <code>@inbounds</code> to skip array bounds checking.</li><li>The function is intended for use in the assembly phase of a mixed finite element method for shallow water or similar PDEs.</li></ul><p><strong>See also</strong></p><ul><li>[<code>ScalarElement</code>]</li><li>[<code>HDivConfElement</code>]</li><li>[<code>QuadRule</code>]</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CGDycore.jl/blob/4f656e525865827c474f4038670be2c7560266f9/src/FEM/StiffMatrix.jl#L1093-L1125">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="CGDycore.FEMSei.CrossRhs!" href="#CGDycore.FEMSei.CrossRhs!"><code>CGDycore.FEMSei.CrossRhs!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>CrossRhs!(backend, FTB, Cross, FeT::HDivElement, u, uFeF::HDivElement, Grid,         ElemType::Grids.ElementType, QuadOrd, Jacobi)</p><p>Assembles the right-hand side vector contribution for the cross product (Coriolis) term in a finite element method (FEM) context, specifically for HDiv-conforming elements on a given grid.</p><p><strong>Arguments</strong></p><ul><li><code>backend</code>: Computational backend (e.g., for parallelization or hardware abstraction).</li><li><code>FTB</code>: (Unused in this function, possibly for future extension or interface compatibility).</li><li><code>Cross</code>: Vector to accumulate the assembled right-hand side contributions.</li><li><code>FeT::HDivElement</code>: Test finite element (HDiv-conforming) structure.</li><li><code>u</code>: Global solution vector (degrees of freedom).</li><li><code>uFeF::HDivElement</code>: Trial finite element (HDiv-conforming) structure.</li><li><code>Grid</code>: Grid structure containing mesh and face information.</li><li><code>ElemType::Grids.ElementType</code>: Element type descriptor for quadrature rule selection.</li><li><code>QuadOrd</code>: Quadrature order for numerical integration.</li><li><code>Jacobi</code>: Function to compute the Jacobian, its determinant, and pseudo-inverse for mapping reference to physical elements.</li></ul><p><strong>Description</strong></p><p>For each face in the grid, the function:</p><ol><li>Evaluates basis functions at quadrature points.</li><li>Maps local degrees of freedom to global solution vector.</li><li>Computes the mapped solution at quadrature points.</li><li>Applies the Coriolis operator (cross product with a vector field <code>k</code>).</li><li>Integrates the result against test functions using quadrature.</li><li>Assembles the local contributions into the global right-hand side vector <code>Cross</code>.</li></ol><p><strong>Notes</strong></p><ul><li>Assumes 3D vector fields and HDiv-conforming elements.</li><li>The Coriolis operator is computed via the <code>Coriolis</code> function, which returns a scalar field and a vector <code>k</code>.</li><li>The function is performance-oriented, using <code>@inbounds</code> for loop optimization.</li></ul><p><strong>See Also</strong></p><ul><li><code>Coriolis</code></li><li><code>QuadRule</code></li><li><code>HDivElement</code></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CGDycore.jl/blob/4f656e525865827c474f4038670be2c7560266f9/src/FEM/StiffMatrix.jl#L1691-L1727">source</a></section><section><div><p>CrossRhs!(backend, FTB, Cross, q, qFeF::ScalarElement, u, uFeF::HDivElement, FeT::HDivElement, Grid,         ElemType::Grids.ElementType, QuadOrd, Jacobi)</p><p>Assembles the right-hand side vector for the cross product term in a finite element method (FEM) context, specifically for mixed finite element spaces involving scalar and H(div) elements.</p><p><strong>Arguments</strong></p><ul><li><code>backend</code>: Computational backend to use (e.g., CPU, GPU).</li><li><code>FTB</code>: (Purpose not specified in code snippet; likely a workspace or buffer).</li><li><code>Cross</code>: Output vector to accumulate the cross product right-hand side contributions.</li><li><code>q</code>: Coefficient vector for the scalar field.</li><li><code>qFeF::ScalarElement</code>: Scalar finite element descriptor for <code>q</code>.</li><li><code>u</code>: Coefficient vector for the H(div) field.</li><li><code>uFeF::HDivElement</code>: H(div) finite element descriptor for <code>u</code>.</li><li><code>FeT::HDivElement</code>: H(div) finite element descriptor for the test space.</li><li><code>Grid</code>: Grid or mesh structure containing geometry and topology information.</li><li><code>ElemType::Grids.ElementType</code>: Element type descriptor for quadrature rule selection.</li><li><code>QuadOrd</code>: Quadrature order for numerical integration.</li><li><code>Jacobi</code>: Function to compute the Jacobian, its determinant, and pseudo-inverse for mapping reference to physical space.</li></ul><p><strong>Description</strong></p><p>For each face in the grid, this function:</p><ul><li>Evaluates basis functions and their values at quadrature points.</li><li>Maps local degrees of freedom to global vectors.</li><li>Computes the mapped vector field and its cross product with a Coriolis-like vector.</li><li>Integrates the resulting expression using quadrature and accumulates the contributions to the global right-hand side vector.</li></ul><p><strong>Notes</strong></p><ul><li>The function is performance-critical and uses in-place operations and preallocated buffers.</li><li>Assumes that the finite element descriptors (<code>qFeF</code>, <code>uFeF</code>, <code>FeT</code>) provide basis function evaluation and global-to-local mapping.</li><li>The <code>Coriolis</code> function is expected to return a vector field and its associated vector at a given point.</li></ul><p><strong>In-place</strong></p><p>Modifies the <code>Cross</code> vector in-place.</p><p><strong>See also</strong></p><ul><li><code>QuadRule</code></li><li><code>Coriolis</code></li><li><code>Jacobi</code></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CGDycore.jl/blob/4f656e525865827c474f4038670be2c7560266f9/src/FEM/StiffMatrix.jl#L1821-L1860">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="CGDycore.FEMSei.Coriolis" href="#CGDycore.FEMSei.Coriolis"><code>CGDycore.FEMSei.Coriolis</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>Coriolis(X, Form)</p><p>Compute the local Coriolis parameter and unit vector for a given position.</p><p><strong>Arguments</strong></p><ul><li><code>X::AbstractVector{&lt;:Real}</code>: A 3-element vector representing the position in Cartesian coordinates.</li><li><code>Form::String</code>: Specifies the geometry. Use <code>&quot;Sphere&quot;</code> for spherical geometry, otherwise a default planar value is used.</li></ul><p><strong>Returns</strong></p><ul><li><code>qFLoc::Float64</code>: The local Coriolis parameter.</li><li><code>k::SVector{3, Float64}</code>: The local unit vector (vertical direction).</li></ul><p><strong>Description</strong></p><p>If <code>Form</code> is <code>&quot;Sphere&quot;</code>, computes the Coriolis parameter based on the latitude derived from the position vector <code>X</code> on a sphere (assuming Earth-like rotation). Otherwise, returns a constant Coriolis parameter and a vertical unit vector for planar geometry.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CGDycore.jl/blob/4f656e525865827c474f4038670be2c7560266f9/src/FEM/StiffMatrix.jl#L1787-L1802">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="CGDycore.FEMSei.DivMomentumVector!" href="#CGDycore.FEMSei.DivMomentumVector!"><code>CGDycore.FEMSei.DivMomentumVector!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>DivMomentumVector!(backend, FTB, Rhs, FeTHDiv::HDivElement, uHDiv, FeHDiv::HDivElement,             uVecDG, FeVecDG::VectorElement, Grid, ElemType::Grids.ElementType,             QuadOrd, Jacobi)</p><p>Assembles the right-hand side (Rhs) vector for the divergence of the momentum equation in a finite element method (FEM) context, using mixed HDiv and DG elements.</p><p><strong>Arguments</strong></p><ul><li><code>backend</code>: Computational backend (e.g., CPU/GPU, not used directly in this function).</li><li><code>FTB</code>: (Unused in this function, possibly for future extension or interface compatibility).</li><li><code>Rhs</code>: Array to be updated in-place with the assembled right-hand side vector.</li><li><code>FeTHDiv::HDivElement</code>: Test function finite element space (H(div) element).</li><li><code>uHDiv</code>: Coefficient vector for the H(div) field.</li><li><code>FeHDiv::HDivElement</code>: Trial function finite element space (H(div) element).</li><li><code>uVecDG</code>: Coefficient vector for the DG vector field.</li><li><code>FeVecDG::VectorElement</code>: Finite element space for the DG vector field.</li><li><code>Grid</code>: Grid structure containing mesh and topology information.</li><li><code>ElemType::Grids.ElementType</code>: Element type (e.g., triangle or quadrilateral).</li><li><code>QuadOrd</code>: Quadrature order for numerical integration.</li><li><code>Jacobi</code>: Function to compute the Jacobian and related geometric quantities.</li></ul><p><strong>Description</strong></p><p>This function computes the local contributions to the right-hand side vector for the divergence of the momentum equation, including both element and edge (upwind) terms. It supports both triangular and quadrilateral elements and handles the assembly of contributions from volume integrals and edge integrals (for upwinding).</p><p>The function:</p><ul><li>Evaluates basis functions and their derivatives at quadrature points.</li><li>Computes local variables and geometric transformations.</li><li>Assembles local contributions to the global right-hand side vector, including upwind fluxes across edges.</li></ul><p><strong>Notes</strong></p><ul><li>The function assumes that the finite element spaces and grid structures are properly initialized and compatible.</li><li>The function is performance-oriented, using in-place updates and preallocated arrays.</li><li>The upwind flux computation distinguishes between left and right elements at each edge and applies the appropriate sign based on the upwind direction.</li></ul><p><strong>See Also</strong></p><ul><li><code>QuadRule</code></li><li><code>HDivElement</code></li><li><code>VectorElement</code></li><li><code>Grids.ElementType</code></li><li><code>Jacobi</code></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CGDycore.jl/blob/4f656e525865827c474f4038670be2c7560266f9/src/FEM/StiffMatrix.jl#L1936-L1976">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="CGDycore.FEMSei.DivMomentumVectorOld!" href="#CGDycore.FEMSei.DivMomentumVectorOld!"><code>CGDycore.FEMSei.DivMomentumVectorOld!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>DivMomentumVectorOld!(backend, FTB, Rhs, FeTHDiv::HDivElement, uHDiv, FeHDiv::HDivElement,              uVecDG, FeVecDG::VectorElement, Grid, ElemType::Grids.ElementType,              QuadOrd, Jacobi)</p><p>Assembles the right-hand side (Rhs) vector for the divergence of the momentum equation in a finite element method (FEM) context, using mixed HDiv and DG vector elements. This function computes local contributions on faces and edges of the mesh and accumulates them into the global Rhs vector.</p><p><strong>Arguments</strong></p><ul><li><code>backend</code>: Computational backend (e.g., CPU/GPU, not used directly in this function).</li><li><code>FTB</code>: (Purpose not specified in the code snippet; likely a data structure for finite element assembly).</li><li><code>Rhs</code>: The global right-hand side vector to be assembled (modified in-place).</li><li><code>FeTHDiv::HDivElement</code>: Test function finite element (H(div) space).</li><li><code>uHDiv</code>: Coefficient vector for H(div) solution.</li><li><code>FeHDiv::HDivElement</code>: Trial function finite element (H(div) space).</li><li><code>uVecDG</code>: Coefficient vector for DG vector solution.</li><li><code>FeVecDG::VectorElement</code>: DG vector finite element.</li><li><code>Grid</code>: Mesh/grid data structure containing faces, edges, and geometric information.</li><li><code>ElemType::Grids.ElementType</code>: Element type (e.g., triangle or quadrilateral).</li><li><code>QuadOrd</code>: Quadrature order for numerical integration.</li><li><code>Jacobi</code>: Function to compute the Jacobian, determinant, and related geometric quantities for mapping reference to physical elements.</li></ul><p><strong>Description</strong></p><ul><li>Evaluates basis functions and their derivatives at quadrature points for both H(div) and DG vector elements.</li><li>Loops over all faces to compute local contributions to the Rhs vector using quadrature.</li><li>Computes upwind fluxes and edge contributions for internal edges, handling both triangle and quadrilateral elements.</li><li>Assembles all local contributions into the global Rhs vector, applying upwind stabilization on edges.</li></ul><p><strong>Notes</strong></p><ul><li>The function is performance-oriented, using <code>@inbounds</code> and preallocated arrays to minimize allocations.</li><li>Assumes specific data structures for finite elements and grid, including global-to-local DoF mappings and geometric information.</li><li>The function is tailored for 2D problems (triangles and quadrilaterals) and vector-valued fields.</li></ul><p><strong>Returns</strong></p><ul><li>Modifies <code>Rhs</code> in-place; does not return a value.</li></ul><p><strong>See Also</strong></p><ul><li><code>QuadRule</code></li><li><code>HDivElement</code></li><li><code>VectorElement</code></li><li><code>Grids.ElementType</code></li><li><code>Jacobi</code></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CGDycore.jl/blob/4f656e525865827c474f4038670be2c7560266f9/src/FEM/StiffMatrix.jl#L2487-L2528">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="CGDycore.FEMSei.CurlVel!" href="#CGDycore.FEMSei.CurlVel!"><code>CGDycore.FEMSei.CurlVel!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p>CurlVel!(q, FeT, u, uFe::HDivElement, QuadOrd, ElemType, Grid, Jacobi)</p><p>Assembles the right-hand side vector <code>q</code> for the weak form of the curl operator applied to a velocity field <code>u</code> in a finite element context. Specifically, computes the integral</p><p>∫ (curl u) ⋅ v dx = -∫ u ⋅ (rot v) dx</p><p>using numerical quadrature over all faces of the grid.</p><p><strong>Arguments</strong></p><ul><li><code>q</code>: Output vector to be assembled (modified in-place).</li><li><code>FeT</code>: Test function finite element type, containing basis and gradient information.</li><li><code>u</code>: Coefficient vector representing the velocity field in the HDiv space.</li><li><code>uFe::HDivElement</code>: Finite element type for the HDiv-conforming space, providing basis functions for <code>u</code>.</li><li><code>QuadOrd</code>: Quadrature order for numerical integration.</li><li><code>ElemType</code>: Element type descriptor (e.g., triangle, quadrilateral).</li><li><code>Grid</code>: Grid structure containing mesh and face connectivity information.</li><li><code>Jacobi</code>: Function to compute the Jacobian, its determinant, and pseudo-inverse for mapping reference to physical elements.</li></ul><p><strong>Details</strong></p><ul><li>Initializes quadrature rules and evaluates basis functions and their gradients at quadrature points.</li><li>Loops over all faces in the grid, assembling local contributions to <code>q</code> using the provided velocity field <code>u</code>.</li><li>Applies the Jacobian transformation to map reference element quantities to the physical element.</li><li>Accumulates contributions using the quadrature weights and basis function gradients.</li><li>Solves the local system using the LU factorization stored in <code>FeT.LUM</code>.</li></ul><p><strong>Notes</strong></p><ul><li>Assumes 2D or 3D vector fields, with appropriate mapping and transformation.</li><li>The function modifies <code>q</code> in-place.</li><li>The function is performance-optimized using <code>@inbounds</code> and preallocated arrays.</li></ul><p><strong>See also</strong></p><ul><li>[<code>QuadRule</code>]</li><li>[<code>HDivElement</code>]</li><li>[<code>ldiv!</code>]</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CGDycore.jl/blob/4f656e525865827c474f4038670be2c7560266f9/src/FEM/StiffMatrix.jl#L2284-L2319">source</a></section><section><div><p>CurlVel!(q, FeT, u, uFe::HDivElement, h, hFe::ScalarElement, QuadOrd, ElemType, Grid, Jacobi)</p><p>Assembles the right-hand side vector <code>q</code> for the weak form of the curl-velocity operator in a finite element method (FEM) context. Specifically, it computes the integral</p><p>∫ q * v dx = ∫ (curl u) * v dx = -∫ u * rot(v) dx</p><p>over all faces of the computational grid, using the provided finite element spaces and quadrature rules.</p><p><strong>Arguments</strong></p><ul><li><code>q</code>: Output vector to be assembled (modified in-place).</li><li><code>FeT</code>: Test function finite element type (provides basis functions and global indexing).</li><li><code>u</code>: Input vector field (typically velocity).</li><li><code>uFe::HDivElement</code>: Finite element description for the velocity field (H(div) space).</li><li><code>h</code>: Scalar field (e.g., height or pressure).</li><li><code>hFe::ScalarElement</code>: Finite element description for the scalar field.</li><li><code>QuadOrd</code>: Quadrature order for numerical integration.</li><li><code>ElemType</code>: Element type (e.g., triangle, quadrilateral).</li><li><code>Grid</code>: Grid structure containing mesh and face information.</li><li><code>Jacobi</code>: Function to compute the Jacobian, its determinant, and pseudo-inverse for mapping reference to physical elements.</li></ul><p><strong>Details</strong></p><ul><li>Loops over all faces in the grid, assembling local contributions to the global vector <code>q</code>.</li><li>Uses quadrature to evaluate integrals on each face.</li><li>Applies the Piola transformation to map basis functions from reference to physical elements.</li><li>Handles both vector and scalar finite element spaces.</li><li>The assembled vector <code>q</code> is solved in-place using the LU decomposition stored in <code>FeT.LUM</code>.</li></ul><p><strong>Notes</strong></p><ul><li>Assumes that all input structures (<code>FeT</code>, <code>uFe</code>, <code>hFe</code>, <code>Grid</code>) are properly initialized and compatible.</li><li>The function is performance-critical and uses in-place operations and <code>@inbounds</code> for efficiency.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/CliMA/CGDycore.jl/blob/4f656e525865827c474f4038670be2c7560266f9/src/FEM/StiffMatrix.jl#L2381-L2412">source</a></section></article><h2 id="Notes"><a class="docs-heading-anchor" href="#Notes">Notes</a><a id="Notes-1"></a><a class="docs-heading-anchor-permalink" href="#Notes" title="Permalink"></a></h2><ul><li>The function assumes that basis functions and their derivatives are provided in the element objects.</li><li>The Jacobian and its inverse are used for mapping and integration.</li><li>Only nonzero entries are stored in the sparse.</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../MassMatrix/">« Mass Matrix</a><a class="docs-footer-nextpage" href="../Examples/">Examples »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Tuesday 19 August 2025 10:15">Tuesday 19 August 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
